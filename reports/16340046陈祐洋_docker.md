# Report

## 任务

### Docker

* 关于 docker

  docker 是一个基于 Linux Conaiiner 的，将相关进程进行隔离，已达到于底层系统分离的技术。其相比虚拟机来说运行时消耗的资源更少，使用起来也更为方便。我在开始了解 docker 这项技术之后，第一个反应是我以前到底浪费了多少时间在配置各种各样的开发环境上。如果使用了 docker，运行各种数据库，各种语言的开发环境是，都不在像以前那样需要处理一大堆依赖关系，配置许多环境变量。甚至因为 Docker for Windows 的存在，在 Windows 上也可以很方便的部署各种应用，而不需要处理 Windows 本身的许多问题（但是在 Windows 下构建 Docker 镜像时会有一些关于文件权限的问题）。

* 关于本次作业

  我负责的部分是前端。React 前端在部署时实际上不需要使用 node 环境，node 实际上只是在开发过程中所需要的。所以我个人对老师所说的需要部署 node 的容器有点不理解。所以本次我使用了 nginx 作为静态文件服务器， 将 webpack 打包出来的静态文件通过 nginx 分发给用户。同时 nginx 会将 “/api” 的请求转发给至3002端口，以使 API 服务器能够通过3002端口响应请求。但是这里遇到了个问题：我暂时没有找到方法让3002的这个目标端口能够在部署容器时由用户自定。监听端口在容器内部时80端口，可以通过端口映射使其监听目标端口。但是 nginx 不支持动态配置转发端口，暂时没有想到更好的办法。

  在构建过程中，首先指定 nginx 为基础镜像。再将打包好的静态文件以及 nginx 的配置文件复制到镜像中的指定路径。完成以上操作后 nginx 会自动启动。打包出来的镜像文件大小大约为 110 MB。

## CI

为了避免每次修改前端代码都需要重新打包 docker 镜像，我也使用了 travis.ci 进行持续集成。同时为了方便将镜像文件分发给用户，这次部署了 GitHub Release。

* travis

  travis 的部分和之前差不多。使用了包含 node 以及 docker 的 linux 环境。步骤如下：

  1. 通过 npm 安装依赖
  2. 打包前端静态文件
  3. 构建镜像文件
  4. 导出镜像文件
  5. 将镜像文件发布至 GitHub Release

* GitHub Release

  我将 travis 的设置调整为只有在检测到 git tag 的存在时才会进行部署。git tag 是 git 管理中可以加入的一个标识符，例如：

  ```bash
  git tag -a "v1.0.1" -m "Version 1.0.1"
  ```

  travis 会以当前 tag 标识为标题将文件发布至 GitHub Release，用户可以通过相关页面下载镜像并使用。

## 一些想法

我觉得这两次作业的内容都非常有意义。docker 大概是未来开发中必不可少的一部分，不论是开发环境的搭建，测试，或是部署，docker 都可以为我们的工作带来极大的方便。travis 的使用 以及 git 的其他功能也会极大地提高我们的工作技能。不过 docker 真的是有用。